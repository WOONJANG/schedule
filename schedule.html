<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>스케줄 관리</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            border: 1px solid black;
            text-align: center;
            padding: 5px;
        }

        .controls {
            margin: 10px 0;
        }

        .full-width {
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>5주간 스케줄 관리</h1>
    <div class="controls">
        <button onclick="addPerson()">인원 추가</button>
        <button onclick="saveSchedule()">저장</button>
        <button onclick="resetSchedule()">초기화</button>
    </div>
    <table>
        <thead>
            <tr>
                <th>이름</th>
                <th>역할</th>
                <th>월</th>
                <th>화</th>
                <th>수</th>
                <th>목</th>
                <th>금</th>
                <th>토</th>
                <th>일</th>
                <th>주간 총 근무시간</th>
                <th>삭제</th>
            </tr>
        </thead>
        <tbody id="scheduleBody">
        </tbody>
    </table>
    <p id="monthlyTotal">한 달 총 근무시간: 0시간</p>

    <script>
        const weekDays = ["월", "화", "수", "목", "금", "토", "일"];
        const workHoursOptions = createTimeOptions(11, 22, 30);
        const breakTimeOptions = createBreakOptions(30, 180, 30);

        function createTimeOptions(startHour, endHour, intervalMinutes) {
            const options = [];
            for (let hour = startHour; hour <= endHour; hour++) {
                for (let minute = 0; minute < 60; minute += intervalMinutes) {
                    const time = `${hour}:${minute.toString().padStart(2, '0')}`;
                    options.push(time);
                }
            }
            return options;
        }

        function createBreakOptions(start, end, interval) {
            const options = [];
            for (let time = start; time <= end; time += interval) {
                options.push(`${time}분`);
            }
            return options;
        }

        function addPerson() {
            const row = document.createElement("tr");

            const nameCell = createTextInputCell("이름");
            const roleCell = createSelectCell(["직원", "알바"], handleRoleChange);
            row.appendChild(nameCell);
            row.appendChild(roleCell);

            weekDays.forEach(() => {
                row.appendChild(document.createElement("td"));
            });

            const totalHoursCell = document.createElement("td");
            totalHoursCell.textContent = "0시간";
            row.appendChild(totalHoursCell);

            const deleteCell = document.createElement("td");
            const deleteButton = document.createElement("button");
            deleteButton.textContent = "삭제";
            deleteButton.onclick = () => {
                document.getElementById("scheduleBody").removeChild(row);
                calculateMonthlyTotal();
            };
            deleteCell.appendChild(deleteButton);
            row.appendChild(deleteCell);

            document.getElementById("scheduleBody").appendChild(row);

            roleCell.querySelector("select").value = "직원";
            handleRoleChange({ target: roleCell.querySelector("select") });
        }

        function createTextInputCell(placeholder) {
            const cell = document.createElement("td");
            const input = document.createElement("input");
            input.type = "text";
            input.placeholder = placeholder;
            input.className = "full-width";
            cell.appendChild(input);
            return cell;
        }

        function createSelectCell(options, changeHandler) {
            const cell = document.createElement("td");
            const select = document.createElement("select");
            select.onchange = changeHandler;
            options.forEach(option => {
                const opt = document.createElement("option");
                opt.value = option;
                opt.textContent = option;
                select.appendChild(opt);
            });
            cell.appendChild(select);
            return cell;
        }

        function handleRoleChange(e) {
            const role = e.target.value;
            const row = e.target.closest("tr");

            for (let i = 2; i < 9; i++) {
                const cell = row.cells[i];
                cell.innerHTML = "";
                if (role === "직원") {
                    cell.appendChild(createSelect(["O", "X"], calculateWeeklyHours));
                } else {
                    const startSelect = createSelect(workHoursOptions, calculateWeeklyHours);
                    const endSelect = createSelect(workHoursOptions, calculateWeeklyHours);
                    const breakSelect = createSelect(breakTimeOptions, calculateWeeklyHours);
                    cell.appendChild(startSelect);
                    cell.appendChild(document.createTextNode("~"));
                    cell.appendChild(endSelect);
                    cell.appendChild(document.createTextNode(" 휴게 "));
                    cell.appendChild(breakSelect);
                }
            }

            calculateWeeklyHours({ target: row });
        }

        function createSelect(options, onchange) {
            const select = document.createElement("select");
            select.onchange = onchange;
            options.forEach(option => {
                const opt = document.createElement("option");
                opt.value = option;
                opt.textContent = option;
                select.appendChild(opt);
            });
            return select;
        }

        function calculateWeeklyHours(e) {
            const row = e.target.closest("tr");
            const role = row.cells[1].querySelector("select").value;

            if (role === "알바") {
                let totalWeeklyHours = 0;
                for (let i = 2; i < 9; i++) {
                    const cell = row.cells[i];
                    const selects = cell.querySelectorAll("select");
                    if (selects.length === 3) {
                        const start = parseTime(selects[0].value);
                        const end = parseTime(selects[1].value);
                        const breakTime = parseInt(selects[2].value);

                        if (end > start) {
                            const workHours = (end - start) - (breakTime / 60);
                            totalWeeklyHours += workHours;
                            cell.textContent = `${workHours.toFixed(1)} 시간`;
                        } else {
                            cell.textContent = "시간 오류";
                        }
                    }
                }

                row.cells[9].textContent = `${totalWeeklyHours.toFixed(1)} 시간`;
            } else {
                for (let i = 2; i < 9; i++) {
                    const cell = row.cells[i];
                    cell.innerHTML = cell.querySelector("select").value === "O" ? "근무" : "휴무";
                }
                row.cells[9].textContent = "N/A";
            }

            calculateMonthlyTotal();
        }

        function parseTime(time) {
            const [hour, minute] = time.split(":");
            return parseInt(hour) + (parseInt(minute) / 60);
        }

        function calculateMonthlyTotal() {
            let totalHours = 0;
            const rows = document.getElementById("scheduleBody").querySelectorAll("tr");

            rows.forEach(row => {
                const totalHoursText = row.cells[9].textContent;
                if (totalHoursText !== "N/A" && totalHoursText !== "시간 오류") {
                    totalHours += parseFloat(totalHoursText);
                }
            });

            document.getElementById("monthlyTotal").textContent = `한 달 총 근무시간: ${totalHours.toFixed(1)}시간`;
        }

        function saveSchedule() {
            const scheduleData = [];
            const rows = document.getElementById("scheduleBody").querySelectorAll("tr");

            rows.forEach(row => {
                const name = row.cells[0].querySelector("input").value;
                const role = row.cells[1].querySelector("select").value;

                const schedule = {};

                if (role === "알바") {
                    for (let i = 2; i < 9; i++) {
                        const cell = row.cells[i];
                        const selects = cell.querySelectorAll("select");
                        if (selects.length === 3) {
                            schedule[weekDays[i - 2]] = {
                                start: selects[0].value,
                                end: selects[1].value,
                                break: selects[2].value
                            };
                        }
                    }
                } else {
                    for (let i = 2; i < 9; i++) {
                        schedule[weekDays[i - 2]] = row.cells[i].querySelector("select").value;
                    }
                }

                const totalWeeklyHours = row.cells[9].textContent;

                scheduleData.push({
                    name,
                    role,
                    schedule,
                    totalWeeklyHours
                });
            });

            localStorage.setItem("workScheduleData", JSON.stringify(scheduleData));
        }

        function loadSchedule() {
            const savedData = localStorage.getItem("workScheduleData");
            if (savedData) {
                const scheduleData = JSON.parse(savedData);

                scheduleData.forEach(person => {
                    const row = addPerson();
                    row.cells[0].querySelector("input").value = person.name;
                    row.cells[1].querySelector("select").value = person.role;

                    for (let i = 2; i < 9; i++) {
                        const cell = row.cells[i];
                        if (person.role === "알바") {
                            const startSelect = cell.querySelectorAll("select")[0];
                            const endSelect = cell.querySelectorAll("select")[1];
                            const breakSelect = cell.querySelectorAll("select")[2];
                            startSelect.value = person.schedule[weekDays[i - 2]].start;
                            endSelect.value = person.schedule[weekDays[i - 2]].end;
                            breakSelect.value = person.schedule[weekDays[i - 2]].break;
                        } else {
                            cell.querySelector("select").value = person.schedule[weekDays[i - 2]];
                        }
                    }

                    row.cells[9].textContent = person.totalWeeklyHours;
                });

                calculateMonthlyTotal();
            }
        }

        function resetSchedule() {
            const confirmation = prompt("스케줄을 초기화하시겠습니까? '초기화'라고 입력하세요.");
            if (confirmation === "초기화") {
                localStorage.removeItem("workScheduleData");
                document.getElementById("scheduleBody").innerHTML = "";
                document.getElementById("monthlyTotal").textContent = "한 달 총 근무시간: 0시간";
            }
        }

        window.onload = () => {
            loadSchedule();
        };
    </script>
</body>
</html>
